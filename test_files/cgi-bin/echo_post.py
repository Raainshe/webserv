#!/usr/bin/python3

import os
import sys
import html

# Read POST data from stdin
content_length = int(os.environ.get('CONTENT_LENGTH', 0))
post_data = ""
if content_length > 0:
    post_data = sys.stdin.read(content_length)

print("Status: 200 OK")
print("Content-Type: text/html")
print("")
print("<!DOCTYPE html>")
print("<html lang=\"en\">")
print("<head>")
print("    <meta charset=\"UTF-8\">")
print("    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">")
print("    <title>CGI POST Echo</title>")
print("    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" rel=\"stylesheet\">")
print("    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css\" rel=\"stylesheet\">")
print("</head>")
print("<body class=\"bg-light\">")
print("    <div class=\"container mt-5\">")
print("        <div class=\"row justify-content-center\">")
print("            <div class=\"col-lg-8\">")
print("                <div class=\"card shadow-sm border-warning\">")
print("                    <div class=\"card-header bg-warning text-dark\">")
print("                        <h1 class=\"card-title mb-0\">")
print("                            <i class=\"bi bi-arrow-repeat\"></i> POST Data Echo")
print("                        </h1>")
print("                    </div>")
print("                    <div class=\"card-body\">")
print("                        <p class=\"lead\">This CGI script echoes back the POST data sent to it.</p>")
print("                        <div class=\"alert alert-success\" role=\"alert\">")
print("                            <h4 class=\"alert-heading\"><i class=\"bi bi-upload\"></i> POST Data Received:</h4>")
print(f"                            <pre class=\"bg-light p-3 rounded\"><code>{html.escape(post_data)}</code></pre>")
print("                        </div>")
print("                        <div class=\"row\">")
print("                            <div class=\"col-md-6\">")
print("                                <div class=\"card\">")
print("                                    <div class=\"card-body\">")
print("                                        <h5 class=\"card-title\"><i class=\"bi bi-hdd\"></i> Content Length</h5>")
print(f"                                        <p class=\"card-text\"><code>{content_length}</code> bytes</p>")
print("                                    </div>")
print("                                </div>")
print("                            </div>")
print("                            <div class=\"col-md-6\">")
print("                                <div class=\"card\">")
print("                                    <div class=\"card-body\">")
print("                                        <h5 class=\"card-title\"><i class=\"bi bi-file-earmark-text\"></i> Content Type</h5>")
print(f"                                        <p class=\"card-text\"><code>{os.environ.get('CONTENT_TYPE', 'Not set')}</code></p>")
print("                                    </div>")
print("                                </div>")
print("                            </div>")
print("                        </div>")
print("                        <div class=\"mt-3\">")
print("                            <a href=\"/\" class=\"btn btn-primary\">")
print("                                <i class=\"bi bi-house\"></i> Back to Home")
print("                            </a>")
print("                        </div>")
print("                    </div>")
print("                    <div class=\"card-footer text-muted text-center\">")
print("                        <small><i class=\"bi bi-gear\"></i> Generated by webserv/1.0 CGI</small>")
print("                    </div>")
print("                </div>")
print("            </div>")
print("        </div>")
print("    </div>")
print("    <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js\"></script>")
print("</body>")
print("</html>")
